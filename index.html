<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <title>OceanCentinell ENTERPRISE - Maritime SIEM</title>

  <style>
    :root{
      --blue-950:#0b1220;
      --blue-900:#0f172a; --blue-800:#1e3a8a; --blue-700:#2563eb;
      --blue-600:#3b82f6; --blue-500:#60a5fa; --blue-400:#93c5fd;
      --green:#10b981; --amber:#f59e0b; --red:#ef4444; --rose:#fb7185;
      --bg:var(--blue-900);
      --card:#111c33;
      --glass:rgba(17, 28, 51, .9);
      --border:rgba(148,163,184,.22);
      --text:#f8fafc; --muted:#94a3b8;
      --radius:16px;
      --shadow:0 30px 80px rgba(0,0,0,.45);
      --focus:0 0 0 4px rgba(96,165,250,.35);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Segoe UI, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 20% 10%, rgba(37,99,235,.28), transparent 55%),
                  radial-gradient(900px 700px at 80% 35%, rgba(16,185,129,.18), transparent 55%),
                  linear-gradient(135deg, var(--bg), var(--blue-800));
      color:var(--text);
    }

    .container{max-width:1700px;margin:0 auto;padding:2rem}

    .header{
      background: linear-gradient(135deg, rgba(37,99,235,.95), rgba(96,165,250,.85));
      padding: 1.6rem 2rem 1.5rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.08);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1.4rem;
      flex-wrap:wrap;
    }

    .header-left{
      display:flex;
      align-items:center;
      gap:.9rem;
      min-width:0;
    }

    .logo-mark{
      width:40px;
      height:40px;
      border-radius:999px;
      background:rgba(15,23,42,.35);
      display:flex;
      align-items:center;
      justify-content:center;
      flex-shrink:0;
      box-shadow:0 0 0 1px rgba(15,23,42,.6), 0 0 12px rgba(15,23,42,.8);
    }
    .logo-svg{
      width:26px;
      height:26px;
      display:block;
    }

    .header-text h1{
      margin:.15rem 0 .2rem;
      font-size: clamp(1.9rem, 2.6vw, 2.7rem);
      letter-spacing:.25px;
    }
    .header-text p{
      margin:0;
      color:#e0f2fe;
      font-size:.95rem;
    }

    .badge{
      display:inline-flex; gap:.65rem; align-items:center; justify-content:center;
      padding:.55rem 1.2rem;
      border-radius:2rem;
      border:1px solid rgba(16,185,129,.55);
      background: rgba(16,185,129,.14);
      font-weight:800;
      backdrop-filter: blur(6px);
      white-space:nowrap;
      font-size:.95rem;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: 1.4rem;
      margin-top: 1.4rem;
    }

    .card{
      background: var(--glass);
      border-radius: var(--radius);
      padding: 1.4rem;
      border: 1px solid var(--border);
      box-shadow: 0 12px 30px rgba(0,0,0,.28);
      backdrop-filter: blur(10px);
      display:flex;
      flex-direction:column;
    }

    .card h3{margin:.1rem 0 1rem;font-size:1.15rem}

    .metrics{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
    }

    .metric{
      background: rgba(30,58,138,.32);
      padding: 1rem .9rem;
      border-radius: 14px;
      text-align:center;
      border: 1px solid rgba(147,197,253,.12);
      min-height: 96px;
      display:flex; flex-direction:column; justify-content:center;
      cursor:pointer;
      transition: background .12s ease, border-color .12s ease, transform .06s ease;
    }
    .metric:hover{background: rgba(37,99,235,.4); border-color: rgba(147,197,253,.35); transform: translateY(-1px);}
    .metric.active{background: rgba(59,130,246,.5); border-color: rgba(191,219,254,.8);}

    .metric-icon{
      margin-bottom:.25rem;
      opacity:.9;
    }
    .metric-icon svg{
      width:20px;height:20px;display:inline-block;fill:none;stroke:#bfdbfe;stroke-width:1.6;
    }

    .metric h2{margin:0;font-size: clamp(1.4rem, 2.1vw, 2.3rem); color: var(--blue-400)}
    .metric span{margin-top:.1rem;font-size:.78rem;color:var(--muted);text-transform:uppercase;letter-spacing:.08em}

    .metric-details{
      margin-top:1rem;
      padding:.8rem 1rem;
      border-radius:12px;
      background:rgba(15,23,42,.9);
      border:1px solid rgba(148,163,184,.25);
      font-size:.9rem;
      display:flex;
      align-items:flex-start;
      gap:.7rem;
    }
    .metric-details-icon svg{
      width:22px;height:22px;display:block;fill:none;stroke:#bfdbfe;stroke-width:1.8;
    }
    .metric-details-main strong{display:block;margin-bottom:.15rem;font-size:.95rem}

    /* MINI‑DASHBOARD BAJO LAS TARJETAS */
    .mini-dash{
      margin-top:0.8rem;
      padding:0.8rem 1rem;
      border-radius:12px;
      background:rgba(15,23,42,.95);
      border:1px solid rgba(30,64,175,.65);
      font-size:.8rem;
    }
    .mini-dash-title{
      font-weight:600;
      font-size:.85rem;
      margin-bottom:.4rem;
      color:#e5e7eb;
    }
    .mini-dash-grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:.5rem .9rem;
    }
    .mini-dash-row{
      display:flex;
      align-items:center;
      gap:.4rem;
    }
    .mini-dash-label{
      flex:0 0 90px;
      color:var(--muted);
    }
    .mini-dash-value{
      font-weight:700;
      color:#e5e7eb;
    }
    .mini-dash-bar{
      position:relative;
      flex:1;
      height:6px;
      border-radius:999px;
      background:rgba(15,23,42,1);
      overflow:hidden;
    }
    .mini-dash-bar-fill{
      position:absolute;
      left:0;top:0;bottom:0;
      border-radius:999px;
      background:linear-gradient(90deg,#22c55e,#eab308,#ef4444);
    }
    .mini-dash-pill{
      padding:.15rem .45rem;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.4);
      font-size:.75rem;
      color:var(--muted);
    }
    .mini-dash-empty{
      color:var(--muted);
    }

    .statusRow{
      display:flex; gap:.8rem; flex-wrap:wrap;
      margin-top:1rem;
      align-items:center; justify-content:space-between;
      color:var(--muted);
      font-size:.92rem;
    }
    .pill{
      display:inline-flex; gap:.45rem; align-items:center;
      padding:.35rem .7rem;
      border-radius:999px;
      background: rgba(148,163,184,.12);
      border: 1px solid rgba(148,163,184,.18);
      white-space:nowrap;
    }
    .pill strong{color:#e2e8f0}
    .dot{width:.6rem;height:.6rem;border-radius:50%}
    .dot.on{background:var(--green)}
    .dot.off{background:rgba(148,163,184,.55)}

    .incidents{
      flex:1;
      max-height: 390px;
      overflow:auto;
      padding-right:.4rem;
      scrollbar-width: thin;
      scrollbar-color: rgba(96,165,250,.45) transparent;
    }
    .incidents::-webkit-scrollbar{width:10px}
    .incidents::-webkit-scrollbar-thumb{background: rgba(96,165,250,.35); border-radius:10px}

    .incidents-toolbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:.6rem;
      font-size:.8rem;
      color:var(--muted);
    }
    .legend{display:flex;gap:.6rem;align-items:center;flex-wrap:wrap}
    .legend-item{display:flex;align-items:center;gap:.25rem}
    .sev-dot{width:.6rem;height:.6rem;border-radius:50%}
    .sev-low{background:var(--green)}
    .sev-med{background:var(--amber)}
    .sev-high{background:var(--red)}
    .sev-crit{background:var(--rose)}

    .incident{
      background: rgba(96,165,250,.10);
      border-left: 4px solid var(--blue-500);
      border-radius: 14px;
      padding: 1.05rem 1.05rem .9rem;
      margin-bottom: .85rem;
      border: 1px solid rgba(148,163,184,.12);
    }
    .incident-header{
      display:flex;
      justify-content:space-between;
      align-items: baseline;
      gap: .75rem;
      font-weight: 800;
    }
    .incident small{display:block;margin-top:.35rem;color:rgba(226,232,240,.86)}

    .tags{display:flex;gap:.5rem;flex-wrap:wrap;margin:.55rem 0 .1rem}
    .tag{
      display:inline-flex;align-items:center;
      padding:.25rem .65rem;border-radius:999px;
      background: rgba(59,130,246,.22);
      border: 1px solid rgba(59,130,246,.30);
      font-size:.78rem;
      letter-spacing:.02em;
    }

    .risk{
      display:inline-flex; align-items:center; justify-content:center;
      padding:.22rem .6rem;
      border-radius:999px;
      font-size:.78rem;
      border:1px solid transparent;
      white-space:nowrap;
    }
    .risk.low{background: rgba(16,185,129,.16); border-color: rgba(16,185,129,.45); color:#d1fae5}
    .risk.medium{background: rgba(245,158,11,.16); border-color: rgba(245,158,11,.50); color:#ffedd5}
    .risk.high{background: rgba(239,68,68,.16); border-color: rgba(239,68,68,.50); color:#ffe4e6}
    .risk.critical{background: rgba(251,113,133,.18); border-color: rgba(251,113,133,.55); color:#fff1f2}

    /* Workspace (10 páginas) */
    .workspace{
      margin-top:1.4rem;
    }
    .workspace-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:1rem;
      flex-wrap:wrap;
      margin-bottom:.7rem;
    }
    .workspace-title{
      font-size:1rem;
      font-weight:600;
    }
    .workspace-subtitle{
      font-size:.85rem;
      color:var(--muted);
    }
    .workspace-tabs{
      margin-top:.4rem;
      display:flex;
      flex-wrap:wrap;
      gap:.4rem;
    }
    .workspace-tab{
      padding:.4rem .7rem;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.35);
      background:rgba(15,23,42,.7);
      font-size:.78rem;
      color:var(--muted);
      cursor:pointer;
    }
    .workspace-tab[aria-selected="true"]{
      background:linear-gradient(135deg, rgba(59,130,246,.9), rgba(96,165,250,.85));
      color:#0b1120;
      border-color:rgba(191,219,254,.9);
    }
    .workspace-pages{
      margin-top:.9rem;
    }
    .workspace-page{
      border-radius:12px;
      border:1px solid rgba(148,163,184,.28);
      padding:1rem 1.1rem;
      background:rgba(15,23,42,.95);
      font-size:.88rem;
    }
    .workspace-page[hidden]{display:none;}

    .ws-row{
      display:flex;
      flex-wrap:wrap;
      gap:.7rem;
      margin-top:.6rem;
    }
    .ws-chip{
      padding:.3rem .7rem;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.4);
      font-size:.78rem;
      color:var(--muted);
    }
    .ws-form-row{
      display:flex;
      flex-wrap:wrap;
      gap:.6rem;
      margin-top:.6rem;
    }
    .ws-form-row label{
      font-size:.8rem;
      color:var(--muted);
      display:flex;
      flex-direction:column;
      gap:.25rem;
    }
    .ws-form-row input,
    .ws-form-row select,
    .ws-form-row textarea{
      background:#020617;
      border-radius:8px;
      border:1px solid rgba(148,163,184,.45);
      padding:.35rem .5rem;
      color:var(--text);
      font-size:.85rem;
      min-width:150px;
    }
    .ws-form-row textarea{
      min-width:260px;
      min-height:70px;
      resize:vertical;
    }
    .ws-actions{
      margin-top:.7rem;
      display:flex;
      flex-wrap:wrap;
      gap:.6rem;
    }
    .ws-log{
      margin-top:.7rem;
      padding:.55rem .7rem;
      border-radius:8px;
      background:#020617;
      border:1px solid rgba(30,64,175,.6);
      max-height:150px;
      overflow:auto;
      font-size:.78rem;
      color:#e5e7eb;
      white-space:pre-wrap;
    }
    .ws-table{
      width:100%;
      border-collapse:collapse;
      margin-top:.5rem;
      font-size:.8rem;
    }
    .ws-table th,
    .ws-table td{
      border-bottom:1px solid rgba(51,65,85,.9);
      padding:.3rem .35rem;
      text-align:left;
    }
    .ws-table th{
      color:#cbd5f5;
      font-weight:600;
    }

    .controls{
      margin: 1.35rem auto 0;
      text-align:center;
      display:flex;
      gap:.65rem;
      flex-wrap:wrap;
      justify-content:center;
    }
    button{
      padding: .85rem 1.25rem;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      cursor:pointer;
      font-weight: 800;
      letter-spacing:.02em;
      color: var(--text);
      background: rgba(148,163,184,.10);
      transition: transform .08s ease, filter .12s ease, background .12s ease;
      user-select:none;
      display:inline-flex;align-items:center;gap:.45rem;
    }
    button span.icon{
      display:inline-flex;
      align-items:center;
      justify-content:center;
    }
    button span.icon svg{
      width:18px;
      height:18px;
      fill:none;
      stroke:#e5e7eb;
      stroke-width:1.8;
    }
    button:hover{filter: brightness(1.05)}
    button:active{transform: translateY(1px)}
    button:focus-visible{outline:none; box-shadow: var(--focus)}
    button.primary{background: linear-gradient(135deg, rgba(59,130,246,.92), rgba(96,165,250,.88))}
    button.secondary{background: linear-gradient(135deg, rgba(147,197,253,.85), rgba(96,165,250,.70)); color:#020617}
    button.success{background: linear-gradient(135deg, rgba(16,185,129,.92), rgba(5,150,105,.86))}
    button.ghost{background: rgba(2,6,23,.25)}
    button[disabled]{opacity:.55; cursor:not-allowed}

    .sr-only{
      position:absolute!important;
      width:1px;height:1px;
      padding:0;margin:-1px;
      overflow:hidden;clip:rect(0,0,0,0);
      white-space:nowrap;border:0;
    }

    @media (max-width: 1100px){
      .grid{grid-template-columns: 1fr; }
      .metrics{grid-template-columns: repeat(2, 1fr);}
      .statusRow{justify-content:center}
    }
    @media (max-width: 720px){
      .header{flex-direction:column;align-items:flex-start}
      .badge{align-self:flex-start}
    }
    @media (max-width: 520px){
      .container{padding:1rem}
      .metrics{grid-template-columns: 1fr;}
      button{width:100%;justify-content:center}
      .statusRow{justify-content:center}
    }
    @media (prefers-reduced-motion: reduce){
      button{transition:none}
      .metric{transition:none}
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- HEADER -->
    <header class="header" aria-label="OceanCentinell Enterprise Header">
      <div class="header-left">
        <div class="logo-mark">
          <svg class="logo-svg" viewBox="0 0 40 40"
               role="img"
               aria-labelledby="oceancentinell-logo-title oceancentinell-logo-desc">
            <title id="oceancentinell-logo-title">OceanCentinell logo</title>
            <desc id="oceancentinell-logo-desc">
              Minimal lighthouse with a signal beam, representing private maritime cyber security.
            </desc>
            <defs>
              <linearGradient id="towerGrad" x1="0" y1="0" x2="0" y2="1">
                <stop offset="0%" stop-color="#e5e7eb"/>
                <stop offset="100%" stop-color="#64748b"/>
              </linearGradient>
              <linearGradient id="seaGrad" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0%" stop-color="#0f172a"/>
                <stop offset="100%" stop-color="#1e3a8a"/>
              </linearGradient>
              <radialGradient id="lightGrad" cx="0.5" cy="0.2" r="0.8">
                <stop offset="0%" stop-color="#facc15" stop-opacity="0.9"/>
                <stop offset="100%" stop-color="#facc15" stop-opacity="0"/>
              </radialGradient>
            </defs>
            <rect x="2" y="26" width="36" height="10" rx="5" fill="url(#seaGrad)"/>
            <path d="M20 10 L38 16 L20 22 Z" fill="url(#lightGrad)" opacity="0.8"/>
            <rect x="17" y="14" width="6" height="15" rx="1.5" fill="url(#towerGrad)"/>
            <rect x="16" y="12" width="8" height="3" rx="1" fill="#cbd5f5"/>
            <polygon points="15,12 25,12 20,8" fill="#1d4ed8"/>
            <path d="M11 9 Q20 4 29 9 Q22 7 20 9 Q18 7 11 9 Z"
                  fill="#f9fafb" stroke="#0f172a" stroke-width="0.6" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="header-text">
          <h1>OceanCentinell  ENTERPRISE</h1>
          <p>Cybersecurity monitoring for private maritime and offshore operators</p>
        </div>
      </div>

      <div class="badge" role="note">
     Enterprise Maritime Cyber Platform · $15,000 USD / Month · Custom Deployment ·  
        Private Fleets · Port & Offshore Operators
   </div>
     </header>

   <!-- GRID PRINCIPAL -->
    <main class="grid" role="main">
      <section class="card" aria-label="Key Metrics">
        <div class="metrics">
          <button class="metric" type="button" data-key="risk" aria-describedby="metricDetailText">
            <div class="metric-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24">
                <path d="M12 3l7 3v5c0 4.2-2.7 8-7 9-4.3-1-7-4.8-7-9V6l7-3z"/>
              </svg>
            </div>
            <h2 id="riskScore" aria-live="polite">–</h2>
            <span>Risk</span>
          </button>
          <button class="metric" type="button" data-key="assets" aria-describedby="metricDetailText">
            <div class="metric-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24">
                <path d="M3 17l3 3h12l3-3-6-2-3 1-3-1-6 2z"/>
                <path d="M6 10l6-3 6 3-1 3H7l-1-3z"/>
                <path d="M12 4v3"/>
              </svg>
            </div>
            <h2 id="assetsCount" aria-live="polite">–</h2>
            <span>Assets</span>
          </button>
          <button class="metric" type="button" data-key="uptime" aria-describedby="metricDetailText">
            <div class="metric-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="8"/>
                <path d="M12 8v4l3 2"/>
              </svg>
            </div>
            <h2 id="uptimeMetric" aria-live="polite">–</h2>
            <span>Uptime</span>
          </button>
          <button class="metric" type="button" data-key="eps" aria-describedby="metricDetailText">
            <div class="metric-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="8"/>
                <circle cx="12" cy="12" r="4"/>
                <path d="M12 12L18 6"/>
                <circle cx="18" cy="6" r="1.2" fill="#bfdbfe" stroke="none"/>
              </svg>
            </div>
            <h2 id="epsMetric" aria-live="polite">–</h2>
            <span>EPS</span>
          </button>
        </div>

        <div class="metric-details" id="metricDetails" aria-live="polite">
          <div class="metric-details-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" id="detailIconSvg">
              <path d="M12 3l7 3v5c0 4.2-2.7 8-7 9-4.3-1-7-4.8-7-9V6l7-3z"/>
            </svg>
          </div>
          <div class="metric-details-main">
            <strong id="metricDetailTitle">Risk Index</strong>
            <span id="metricDetailText">Tap any metric card to see an executive explanation and the current reading.</span>
          </div>
        </div>

        <div class="mini-dash" id="miniDash">
          <div class="mini-dash-empty">
            Click on any metric card to open a focused mini‑dashboard.
          </div>
        </div>

        <div class="statusRow" aria-label="Demo Status">
          <div class="pill" title="Auto-refresh status">
            <span class="dot" id="autoDot"></span>
            <span id="autoText">Auto refresh: –</span>
          </div>
          <div class="pill" title="List price">
            <span>List price:</span>
            <strong id="pricePill">–</strong>
          </div>
          <div class="pill" title="Last update time">
            <span>Last update:</span>
            <span id="lastUpdate">–</span>
          </div>
          <div class="pill" title="Incident buffer size">
            <span>Buffer:</span>
            <span id="bufferCount">0</span>
          </div>
        </div>
      </section>

      <section class="card" aria-label="Active Threats">
        <h3>Active Threats</h3>

        <div class="incidents-toolbar">
          <div class="legend" aria-hidden="true">
            <div class="legend-item"><span class="sev-dot sev-low"></span><span>Low</span></div>
            <div class="legend-item"><span class="sev-dot sev-med"></span><span>Med</span></div>
            <div class="legend-item"><span class="sev-dot sev-high"></span><span>High</span></div>
            <div class="legend-item"><span class="sev-dot sev-crit"></span><span>Critical</span></div>
          </div>
          <div>Demo Mode: simulated maritime cyber incidents (region-agnostic)</div>
        </div>

        <div class="incidents" id="incidentsContainer">
          <p id="emptyState" style="color:var(--muted); margin:.2rem 0 0;">Waiting for data...</p>
        </div>

        <p class="sr-only" id="srAnnounce" aria-live="polite" aria-atomic="true"></p>
      </section>
    </main>

    <section class="card workspace" aria-label="Operations workspace">
      <div class="workspace-header">
        <div>
          <div class="workspace-title" id="wsTitle">Execution · Risk Index</div>
          <div class="workspace-subtitle" id="wsSubtitle">
            Select a metric or module to open its execution view for fishing fleets and private commercial tenants.
          </div>
        </div>
        <span class="workspace-subtitle">All modules are region-agnostic and tenant configurable.</span>
      </div>

      <div class="workspace-tabs" role="tablist" aria-label="Execution modules">
        <button class="workspace-tab" role="tab" aria-selected="true" data-page="fleet">1 · Fleet registry</button>
        <button class="workspace-tab" role="tab" aria-selected="false" data-page="satcom">2 · SatCom links</button>
        <button class="workspace-tab" role="tab" aria-selected="false" data-page="vhf">3 · VHF guard</button>
        <button class="workspace-tab" role="tab" aria-selected="false" data-page="ais">4 · AIS integrity</button>
        <button class="workspace-tab" role="tab" aria-selected="false" data-page="endpoints">5 · Endpoint health</button>
        <button class="workspace-tab" role="tab" aria-selected="false" data-page="access">6 · Access control</button>
        <button class="workspace-tab" role="tab" aria-selected="false" data-page="drills">7 · Incident drills</button>
        <button class="workspace-tab" role="tab" aria-selected="false" data-page="geofence">8 · Geo‑fences</button>
        <button class="workspace-tab" role="tab" aria-selected="false" data-page="compliance">9 · Compliance</button>
        <button class="workspace-tab" role="tab" aria-selected="false" data-page="failover">10 · Emergency failover</button>
      </div>

      <div class="workspace-pages">
        <div class="workspace-page" data-page="fleet" role="tabpanel">
          <strong>Fleet registry for fishing & service vessels</strong>
          <div class="ws-form-row">
            <label>Vessel name
              <input id="fleetName" placeholder="e.g. F/V Victoria" />
            </label>
            <label>MMSI / Call sign
              <input id="fleetId" placeholder="e.g. 123456789" />
            </label>
            <label>Role
              <select id="fleetRole">
                <option value="fishing">Fishing</option>
                <option value="service">Service / support</option>
                <option value="research">Research</option>
              </select>
            </label>
          </div>
          <div class="ws-actions">
            <button class="primary" type="button" id="btnAddVessel">Add vessel</button>
            <button class="ghost" type="button" id="btnClearFleet">Clear list</button>
          </div>
          <table class="ws-table" id="fleetTable">
            <thead>
              <tr><th>Vessel</th><th>ID</th><th>Role</th><th>Onboarded</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="workspace-page" data-page="satcom" role="tabpanel" hidden>
          <strong>Satellite communications health</strong>
          <div class="ws-form-row">
            <label>Link profile
              <select id="satProfile">
                <option value="basic">Basic fishing fleet (L-band)</option>
                <option value="enterprise">Enterprise fleet (Ku-band)</option>
                <option value="resilient">High-resilience fleet profile</option>
              </select>
            </label>
            <label>Target vessel
              <input id="satVessel" placeholder="Any registered vessel" />
            </label>
          </div>
          <div class="ws-actions">
            <button class="primary" type="button" id="btnSatHealth">Run link health check</button>
            <button class="ghost" type="button" id="btnSatBaseline">Update baseline</button>
          </div>
          <div class="ws-log" id="satLog" aria-live="polite">
            Awaiting SatCom tests…
          </div>
        </div>

        <div class="workspace-page" data-page="vhf" role="tabpanel" hidden>
          <strong>VHF / UHF channel guard</strong>
          <div class="ws-form-row">
            <label><input type="checkbox" class="vhf-ch" value="16" checked /> Guard Ch 16 (distress)</label>
            <label><input type="checkbox" class="vhf-ch" value="70" /> DSC Ch 70</label>
            <label><input type="checkbox" class="vhf-ch" value="13" /> Manoeuvring Ch 13</label>
            <label><input type="checkbox" class="vhf-ch" value="Custom" /> Custom ops channel</label>
          </div>
          <div class="ws-actions">
            <button class="primary" type="button" id="btnApplyVhf">Apply guard policy</button>
          </div>
          <div class="ws-log" id="vhfLog">No VHF guard policy applied yet.</div>
        </div>

        <div class="workspace-page" data-page="ais" role="tabpanel" hidden>
          <strong>AIS & tracking integrity</strong>
          <div class="ws-row">
            <span class="ws-chip">Spoofing detection</span>
            <span class="ws-chip">Silent vessels</span>
            <span class="ws-chip">Unexpected rendezvous</span>
          </div>
          <div class="ws-actions">
            <button class="primary" type="button" id="btnAisScan">Run AIS integrity scan</button>
          </div>
          <div class="ws-log" id="aisLog">No AIS scan executed.</div>
        </div>

        <div class="workspace-page" data-page="endpoints" role="tabpanel" hidden>
          <strong>Onboard endpoint health (bridge PCs, ECDIS, sensors)</strong>
          <div class="ws-form-row">
            <label>Endpoint group
              <select id="epGroup">
                <option value="bridge">Bridge systems</option>
                <option value="engineering">Engineering room</option>
                <option value="fleet">All fleet endpoints</option>
              </select>
            </label>
            <label>Depth
              <select id="epDepth">
                <option value="quick">Quick check</option>
                <option value="full">Full malware scan</option>
              </select>
            </label>
          </div>
          <div class="ws-actions">
            <button class="primary" type="button" id="btnEpScan">Run endpoint scan</button>
          </div>
          <div class="ws-log" id="epLog">No endpoint scans executed.</div>
        </div>

        <div class="workspace-page" data-page="access" role="tabpanel" hidden>
          <strong>Crew access control & MFA</strong>
          <div class="ws-form-row">
            <label>Password policy
              <select id="accPolicy">
                <option value="standard">Standard (12 chars)</option>
                <option value="strong">Strong (16 chars, symbols)</option>
                <option value="hardened">Hardened (20 chars, rotated)</option>
              </select>
            </label>
            <label>MFA requirement
              <select id="accMfa">
                <option value="bridge-only">Bridge consoles only</option>
                <option value="all-crew">All crew accounts</option>
                <option value="contractors">Contractors + remote</option>
              </select>
            </label>
          </div>
          <div class="ws-actions">
            <button class="primary" type="button" id="btnApplyAccess">Apply access policy</button>
          </div>
          <div class="ws-log" id="accLog">No access policy changes pending.</div>
        </div>

        <div class="workspace-page" data-page="drills" role="tabpanel" hidden>
          <strong>Cyber incident drills for crews</strong>
          <div class="ws-form-row">
            <label>Scenario
              <select id="drillScenario">
                <option value="phishing">Phishing against fleet master</option>
                <option value="ransomware">Ransomware on bridge PC</option>
                <option value="gps-jam">GPS jamming near fishing grounds</option>
              </select>
            </label>
            <label>Target vessel
              <input id="drillVessel" placeholder="Optional vessel name" />
            </label>
          </div>
          <div class="ws-actions">
            <button class="primary" type="button" id="btnLaunchDrill">Launch drill (simulated)</button>
          </div>
          <div class="ws-log" id="drillLog">No drills launched.</div>
        </div>

        <div class="workspace-page" data-page="geofence" role="tabpanel" hidden>
          <strong>Operational geo‑fences</strong>
          <div class="ws-form-row">
            <label>Fence name
              <input id="geoName" placeholder="e.g. Fishing Ground A" />
            </label>
            <label>Radius (NM)
              <input id="geoRadius" type="number" min="1" max="500" value="25" />
            </label>
          </div>
          <div class="ws-actions">
            <button class="primary" type="button" id="btnApplyGeo">Apply geo‑fence</button>
          </div>
          <div class="ws-log" id="geoLog">No geo‑fences configured.</div>
        </div>

        <div class="workspace-page" data-page="compliance" role="tabpanel" hidden>
          <strong>Log retention & compliance profile</strong>
          <div class="ws-form-row">
            <label>Retention (days)
              <input id="cmpRetention" type="number" min="7" max="365" value="180" />
            </label>
            <label>Profile
              <select id="cmpProfile">
                <option value="baseline">Baseline fleet</option>
                <option value="iso">ISO 27001 maritime</option>
                <option value="extended">Extended long‑term archive</option>
              </select>
            </label>
          </div>
          <div class="ws-actions">
            <button class="primary" type="button" id="btnSaveCompliance">Save compliance profile</button>
          </div>
          <div class="ws-log" id="cmpLog">No compliance profile saved.</div>
        </div>

        <div class="workspace-page" data-page="failover" role="tabpanel" hidden>
          <strong>Emergency communications failover</strong>
          <div class="ws-form-row">
            <label>Primary link
              <select id="foPrimary">
                <option value="satcom">SatCom provider</option>
                <option value="shore">Shore radio network</option>
              </select>
            </label>
            <label>Backup link
              <select id="foBackup">
                <option value="cellular">4G/5G coastal</option>
                <option value="hf">HF radio</option>
                <option value="alt-sat">Alternate SatCom</option>
              </select>
            </label>
          </div>
          <div class="ws-actions">
            <button class="primary" type="button" id="btnTestFailover">Run failover test</button>
          </div>
          <div class="ws-log" id="foLog">No failover test executed.</div>
        </div>
      </div>
    </section>

    <div class="controls" role="group" aria-label="Controls">
      <button class="primary" id="forceScanBtn" type="button">
        <span class="icon" aria-hidden="true">
          <svg viewBox="0 0 24 24">
            <path d="M4 4v6h6"/>
            <path d="M5 13a7 7 0 0 0 12 3"/>
            <path d="M20 11V5h-6"/>
            <path d="M19 11a7 7 0 0 0-12-3"/>
          </svg>
        </span>
        <span>Force Scan</span>
      </button>
      <button class="ghost" id="toggleAutoBtn" type="button">
        <span class="icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" id="autoIconSvg">
            <path d="M9 7h2v10H9zM13 7h2v10h-2z"/>
          </svg>
        </span>
        <span>Pause Auto</span>
      </button>
      <button class="secondary" id="clearBtn" type="button">
        <span class="icon" aria-hidden="true">
          <svg viewBox="0 0 24 24">
            <path d="M4 18l4-4 6 6H6a2 2 0 0 1-2-2z"/>
            <path d="M14 4l6 6-2 2-6-6z"/>
          </svg>
        </span>
        <span>Clear</span>
      </button>
      <button class="success" id="exportBtn" type="button">
        <span class="icon" aria-hidden="true">
          <svg viewBox="0 0 24 24">
            <path d="M12 3v12"/>
            <path d="M8 7l4-4 4 4"/>
            <path d="M5 14v4a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-4"/>
          </svg>
        </span>
        <span>Executive Report</span>
      </button>
    </div>
  </div>

  <script>
    (() => {
      "use strict";

      const LIST_PRICE_MONTHLY_USD = 15000;

      const CONFIG = {
        refreshMs: 4000,
        maxIncidents: 60,
        exportRevokeDelayMs: 1200,
        announceCooldownMs: 7000,
      };

      const $ = (id) => document.getElementById(id);

      const els = {
        riskScore: $("riskScore"),
        assetsCount: $("assetsCount"),
        uptimeMetric: $("uptimeMetric"),
        epsMetric: $("epsMetric"),
        incidents: $("incidentsContainer"),
        emptyState: $("emptyState"),
        srAnnounce: $("srAnnounce"),
        autoDot: $("autoDot"),
        autoText: $("autoText"),
        lastUpdate: $("lastUpdate"),
        bufferCount: $("bufferCount"),
        pricePill: $("pricePill"),
        metricDetails: $("metricDetails"),
        metricDetailTitle: $("metricDetailTitle"),
        metricDetailText: $("metricDetailText"),

        forceScanBtn: $("forceScanBtn"),
        clearBtn: $("clearBtn"),
        exportBtn: $("exportBtn"),
        toggleAutoBtn: $("toggleAutoBtn"),

        wsTitle: $("wsTitle"),
        wsSubtitle: $("wsSubtitle"),
      };

      const metricCards = Array.from(document.querySelectorAll(".metric"));
      const metricDetailsIcon = document.getElementById("detailIconSvg");
      const autoIconSvg = document.getElementById("autoIconSvg");
      const miniDash = document.getElementById("miniDash");

      const wsTabs = Array.from(document.querySelectorAll(".workspace-tab"));
      const wsPages = Array.from(document.querySelectorAll(".workspace-page"));

      const fmtTime = new Intl.DateTimeFormat(undefined, {
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
      });

      const fmtMoney = new Intl.NumberFormat("en-US", {
        style: "currency",
        currency: "USD",
        maximumFractionDigits: 0
      });

      function safeFilenameTimestamp(isoString){
        return String(isoString)
          .replace(/\.\d{3}Z$/, "Z")
          .replace(/:/g, "-");
      }

      function riskBucket(score){
        if (score >= 90) return "CRITICAL";
        if (score >= 75) return "HIGH";
        if (score >= 50) return "MEDIUM";
        return "LOW";
      }

      function riskClass(risk){
        const r = String(risk || "").toLowerCase();
        if (r === "critical") return "critical";
        if (r === "high") return "high";
        if (r === "medium") return "medium";
        return "low";
      }

      class OceanCentinellSIEM {
        constructor() {
          this.incidents = [];
          this.metrics = { risk_score: null, assets: null, uptime: null, eps: null };
          this.maxIncidents = CONFIG.maxIncidents;

          this._timer = null;
          this._auto = false;
          this._started = false;

          this._lastBatchCount = 0;
          this._lastAnnounceAt = 0;

          this._exportLock = false;

          this.activeVessel = null;
        }

        start() {
          if (this._started) return;
          this._started = true;

          this.refreshAll({ newIncidents: true, announce: false });
          this._setAuto(true);
        }

        stop() {
          this._setAuto(false);
        }

        destroy() {
          this.stop();
          this._started = false;
        }

        _setAuto(enabled) {
          this._auto = Boolean(enabled);

          if (this._timer) {
            clearInterval(this._timer);
            this._timer = null;
          }

          els.autoDot.className = "dot " + (this._auto ? "on" : "off");
          els.autoText.textContent = `Auto refresh: ${this._auto ? "ON" : "OFF"}`;

          if (this._auto) {
            autoIconSvg.innerHTML = '<path d="M9 7h2v10H9zM13 7h2v10h-2z"/>';
            if (els.toggleAutoBtn) {
              const span = els.toggleAutoBtn.querySelector("span:last-child");
              if (span) span.textContent = "Pause Auto";
            }
          } else {
            autoIconSvg.innerHTML = '<path d="M9 7l8 5-8 5z"/>';
            if (els.toggleAutoBtn) {
              const span = els.toggleAutoBtn.querySelector("span:last-child");
              if (span) span.textContent = "Resume Auto";
            }
          }

          if (this._auto) {
            this._timer = setInterval(() => {
              try {
                const add = Math.random() > 0.45;
                this.refreshAll({ newIncidents: add, announce: add });
              } catch (e) {
                console.error("OceanCentinell tick failure:", e);
                this._setAuto(false);
                this._announce("Auto refresh stopped due to internal error.");
              }
            }, CONFIG.refreshMs);
          }
        }

        toggleAuto() {
          this._setAuto(!this._auto);
        }

        refreshAll({ newIncidents, announce }) {
          this._updateMockMetrics();
          if (newIncidents) this._appendMockIncidents();
          this._render();

          if (announce && newIncidents) {
            const now = Date.now();
            if (now - this._lastAnnounceAt > CONFIG.announceCooldownMs) {
              this._announce(`${this._lastBatchCount} new incident(s) added.`);
              this._lastAnnounceAt = now;
            }
          }
        }

        clear() {
          this.incidents = [];
          this._render();
          this._announce("Incidents cleared.");
        }

        forceScan() {
          this.refreshAll({ newIncidents: true, announce: true });
        }

        _updateMockMetrics() {
          const risk = +(Math.random() * 100).toFixed(1);
          const uptime = +(99 + Math.random()).toFixed(2);
          const eps = Math.floor(Math.random() * 5000 + 3000);
          const assets = Math.floor(20 + Math.random() * 220);

          this.metrics = {
            risk_score: risk,
            assets,
            uptime,
            eps,
            risk_level: riskBucket(risk),
            updated_at: new Date(),
          };
        }

        _appendMockIncidents() {
          const vectors = [
            "Phishing",
            "Port Scan",
            "Malware Beacon",
            "Ransomware",
            "Brute Force",
            "DDoS",
          ];
          const regions = [
            "Operational Zone Alpha",
            "Operational Zone Bravo",
            "Operational Zone Charlie",
            "Offshore Sector 1",
            "Harbor Sector 2",
          ];
          const assets = [
            "Bridge Server",
            "NavCom",
            "Radar Host",
            "AIS Node",
            "Fleet Gateway",
          ];

          const batchSize = Math.floor(2 + Math.random() * 5);
          this._lastBatchCount = batchSize;

          const now = new Date();
          const baseId = 1000 + Math.floor(Math.random() * 9000);

          const batch = Array.from({ length: batchSize }, (_, k) => {
            const risk = ["LOW", "MEDIUM", "HIGH", "CRITICAL"][
              Math.floor(Math.random() * 4)
            ];
            const vector = vectors[Math.floor(Math.random() * vectors.length)];
            const region = regions[Math.floor(Math.random() * regions.length)];
            const asset = assets[Math.floor(Math.random() * assets.length)];

            return {
              id: `INC-${baseId + k}`,
              risk,
              vector,
              region,
              asset,
              vessel: this.activeVessel || "Any registered vessel",
              timestamp: now.toISOString(),
            };
          });

          this.incidents = [...batch, ...this.incidents].slice(0, this.maxIncidents);
        }

        _render() {
          const m = this.metrics;

          els.pricePill.textContent = `${fmtMoney.format(
            LIST_PRICE_MONTHLY_USD
          )}/mo`;

          els.riskScore.textContent = m.risk_score ?? "–";
          els.assetsCount.textContent = m.assets ?? "–";
          els.uptimeMetric.textContent =
            m.uptime != null ? `${m.uptime}%` : "–";
          els.epsMetric.textContent =
            m.eps != null ? `${(m.eps / 1000).toFixed(1)}K` : "–";

          els.lastUpdate.textContent = m.updated_at
            ? fmtTime.format(m.updated_at)
            : "–";
          els.bufferCount.textContent = String(this.incidents.length);

          els.incidents.replaceChildren();
          if (!this.incidents.length) {
            els.incidents.appendChild(els.emptyState);
            return;
          }

          const frag = document.createDocumentFragment();

          for (const i of this.incidents) {
            const card = document.createElement("div");
            card.className = "incident";

            const header = document.createElement("div");
            header.className = "incident-header";

            const left = document.createElement("span");
            left.textContent = i.id;

            const right = document.createElement("span");
            right.className = `risk ${riskClass(i.risk)}`;
            right.textContent = i.risk;

            header.append(left, right);

            const tags = document.createElement("div");
            tags.className = "tags";

            const t1 = document.createElement("span");
            t1.className = "tag";
            t1.textContent = i.vector;

            const t2 = document.createElement("span");
            t2.className = "tag";
            t2.textContent = i.asset;

            const t3 = document.createElement("span");
            t3.className = "tag";
            t3.textContent = i.region;

            tags.append(t1, t2, t3);

            const small = document.createElement("small");
            const time = new Date(i.timestamp);
            small.textContent =
              `Seen: ${fmtTime.format(time)} · Vessel: ${i.vessel} · Asset: ${i.asset} · Zone: ${i.region}`;

            card.append(header, tags, small);
            frag.appendChild(card);
          }

          els.incidents.appendChild(frag);
        }

        _announce(msg) {
          els.srAnnounce.textContent = msg;
          window.setTimeout(() => {
            els.srAnnounce.textContent = "";
          }, 1200);
        }

        exportExecutiveReport() {
          if (this._exportLock) return;

          this._exportLock = true;
          els.exportBtn.disabled = true;

          let url = null;

          try {
            const exportedAt = new Date().toISOString();
            const report = {
              platform: "OceanCentinell ENTERPRISE v3.2 (Offline Demo)",
              org: "Victoria en Cristo Jesús LLC",
              list_price_monthly_usd: LIST_PRICE_MONTHLY_USD,
              exported_at: exportedAt,
              metrics: this.metrics,
              incidents: this.incidents,
            };

            const json = JSON.stringify(report, null, 2);
            const blob = new Blob([json], { type: "application/json" });
            url = URL.createObjectURL(blob);

            const a = document.createElement("a");
            a.href = url;
            const ts = safeFilenameTimestamp(exportedAt);
            a.download = `OceanCentinell_Report_${LIST_PRICE_MONTHLY_USD}USD-MO_${ts}.json`;
            document.body.appendChild(a);
            a.click();
            a.remove();

            this._announce("Executive report exported.");
          } catch (e) {
            console.error("Export failed:", e);
            this._announce("Export failed. See console for details.");
          } finally {
            if (url) {
              window.setTimeout(() => {
                try {
                  URL.revokeObjectURL(url);
                } catch (_) {}
              }, CONFIG.exportRevokeDelayMs);
            }

            window.setTimeout(() => {
              this._exportLock = false;
              els.exportBtn.disabled = false;
            }, 350);
          }
        }
      }

      const siem = new OceanCentinellSIEM();
      siem.start();

      els.forceScanBtn.addEventListener("click", () => siem.forceScan());
      els.clearBtn.addEventListener("click", () => siem.clear());
      els.exportBtn.addEventListener("click", () => siem.exportExecutiveReport());
      els.toggleAutoBtn.addEventListener("click", () => siem.toggleAuto());

      const metricDescriptions = {
        risk: {
          title: "Risk Index",
          getText: (m) =>
            `Current cyber risk index for your monitored maritime estate. Current score: ${
              m.risk_score ?? "–"
            }.`,
        },
        assets: {
          title: "Protected Assets",
          getText: (m) =>
            `Number of critical maritime assets under monitoring. Current assets in scope: ${
              m.assets ?? "–"
            }.`,
        },
        uptime: {
          title: "Platform Uptime",
          getText: (m) =>
            `Service availability of the OceanCentinell stack. Current uptime: ${
              m.uptime != null ? m.uptime + "%" : "–"
            }.`,
        },
        eps: {
          title: "Events Per Second",
          getText: (m) => {
            const eps = m.eps != null ? m.eps.toString() : "–";
            return `Inbound security telemetry ingestion rate. Current EPS: ${eps} events/second.`;
          },
        },
      };

      function setDetailIcon(key){
        if (key === "risk"){
          metricDetailsIcon.innerHTML = '<path d="M12 3l7 3v5c0 4.2-2.7 8-7 9-4.3-1-7-4.8-7-9V6l7-3z"/>';
        } else if (key === "assets"){
          metricDetailsIcon.innerHTML =
            '<path d="M3 17l3 3h12l3-3-6-2-3 1-3-1-6 2z"/>' +
            '<path d="M6 10l6-3 6 3-1 3H7l-1-3z"/>' +
            '<path d="M12 4v3"/>';
        } else if (key === "uptime"){
          metricDetailsIcon.innerHTML =
            '<circle cx="12" cy="12" r="8"/>' +
            '<path d="M12 8v4l3 2"/>';
        } else if (key === "eps"){
          metricDetailsIcon.innerHTML =
            '<circle cx="12" cy="12" r="8"/>' +
            '<circle cx="12" cy="12" r="4"/>' +
            '<path d="M12 12L18 6"/>' +
            '<circle cx="18" cy="6" r="1.4" fill="#bfdbfe" stroke="none"/>';
        }
      }

      const METRIC_TO_PAGE = {
        risk: "fleet",
        assets: "fleet",
        uptime: "endpoints",
        eps: "satcom",
      };

      function renderMiniDash(key, metrics, incidents){
        if (!miniDash) return;
        const m = metrics || {};
        const list = incidents || [];

        const riskCounts = { LOW:0, MEDIUM:0, HIGH:0, CRITICAL:0 };
        for (let i = 0; i < Math.min(list.length, 40); i++){
          const r = String(list[i].risk || "").toUpperCase();
          if (riskCounts.hasOwnProperty(r)) riskCounts[r]++;
        }

        if (key === "risk"){
          const numericScore = typeof m.risk_score === "number" ? m.risk_score : 0;
          const scoreText = m.risk_score != null ? m.risk_score.toFixed(1) : "–";
          const pct = Math.max(0, Math.min(100, numericScore));

          miniDash.innerHTML = `
            <div class="mini-dash-title">Risk mini‑dashboard</div>
            <div class="mini-dash-row">
              <span class="mini-dash-label">Index</span>
              <div class="mini-dash-bar">
                <div class="mini-dash-bar-fill" style="width:${pct}%;"></div>
              </div>
              <span class="mini-dash-value">${scoreText}</span>
            </div>
            <div class="mini-dash-grid" style="margin-top:.5rem;">
              <div class="mini-dash-row">
                <span class="mini-dash-label">Low</span>
                <span class="mini-dash-value">${riskCounts.LOW}</span>
              </div>
              <div class="mini-dash-row">
                <span class="mini-dash-label">Medium</span>
                <span class="mini-dash-value">${riskCounts.MEDIUM}</span>
              </div>
              <div class="mini-dash-row">
                <span class="mini-dash-label">High</span>
                <span class="mini-dash-value">${riskCounts.HIGH}</span>
              </div>
              <div class="mini-dash-row">
                <span class="mini-dash-label">Critical</span>
                <span class="mini-dash-value">${riskCounts.CRITICAL}</span>
              </div>
            </div>
          `;
        } else if (key === "assets"){
          const assets = typeof m.assets === "number" ? m.assets : 0;
          const guarded = Math.round(assets * 0.85);
          const unguarded = Math.max(0, assets - guarded);
          const pct = assets ? Math.max(0, Math.min(100, guarded / assets * 100)) : 0;

          miniDash.innerHTML = `
            <div class="mini-dash-title">Assets mini‑dashboard</div>
            <div class="mini-dash-row">
              <span class="mini-dash-label">Total</span>
              <span class="mini-dash-value">${assets}</span>
            </div>
            <div class="mini-dash-row">
              <span class="mini-dash-label">Guarded</span>
              <div class="mini-dash-bar">
                <div class="mini-dash-bar-fill" style="width:${pct.toFixed(0)}%;"></div>
              </div>
              <span class="mini-dash-value">${guarded}</span>
            </div>
            <div class="mini-dash-row">
              <span class="mini-dash-label">Gap</span>
              <span class="mini-dash-value">${unguarded}</span>
            </div>
          `;
        } else if (key === "uptime"){
          const up = typeof m.uptime === "number" ? m.uptime : 0;
          const pct = Math.max(0, Math.min(100, up));
          const downMinutes = ((100 - up) / 100 * 30 * 24 * 60);
          const downText = Number.isFinite(downMinutes) ? downMinutes.toFixed(0) : "–";

          miniDash.innerHTML = `
            <div class="mini-dash-title">Uptime mini‑dashboard</div>
            <div class="mini-dash-row">
              <span class="mini-dash-label">Uptime</span>
              <div class="mini-dash-bar">
                <div class="mini-dash-bar-fill" style="width:${pct}%;"></div>
              </div>
              <span class="mini-dash-value">${up ? up.toFixed(2) : "–"}%</span>
            </div>
            <div class="mini-dash-row" style="margin-top:.4rem;">
              <span class="mini-dash-label">Est. downtime</span>
              <span class="mini-dash-value">${downText} min / 30 days</span>
            </div>
          `;
        } else if (key === "eps"){
          const eps = typeof m.eps === "number" ? m.eps : 0;
          const k = (eps/1000).toFixed(1);
          const cap = 8000;
          const pct = Math.max(0, Math.min(100, eps / cap * 100));
          const headroom = Math.max(0, cap - eps);

          miniDash.innerHTML = `
            <div class="mini-dash-title">EPS mini‑dashboard</div>
            <div class="mini-dash-row">
              <span class="mini-dash-label">Current</span>
              <div class="mini-dash-bar">
                <div class="mini-dash-bar-fill" style="width:${pct}%;"></div>
              </div>
              <span class="mini-dash-value">${eps ? k + "K" : "–"}</span>
            </div>
            <div class="mini-dash-grid" style="margin-top:.5rem;">
              <div class="mini-dash-row">
                <span class="mini-dash-label">Headroom</span>
                <span class="mini-dash-value">${headroom} EPS</span>
              </div>
              <div class="mini-dash-row">
                <span class="mini-dash-label">Capacity</span>
                <span class="mini-dash-value">${cap} EPS</span>
              </div>
            </div>
          `;
        } else {
          miniDash.innerHTML = `
            <div class="mini-dash-empty">
              Click on any metric card to open a focused mini‑dashboard.
            </div>
          `;
        }
      }

      function activateWorkspacePage(pageId){
        wsTabs.forEach(tab => {
          const isActive = tab.dataset.page === pageId;
          tab.setAttribute("aria-selected", isActive ? "true" : "false");
        });

        wsPages.forEach(page => {
          page.hidden = page.dataset.page !== pageId;
        });

        const label = wsTabs.find(t => t.dataset.page === pageId)?.textContent || "";
        els.wsTitle.textContent = `Execution · ${label}`;
      }

      function updateMetricDetail(key, metrics){
        const cfg = metricDescriptions[key];
        if (!cfg) return;

        metricCards.forEach(c => c.classList.toggle("active", c.dataset.key === key));
        setDetailIcon(key);
        els.metricDetailTitle.textContent = cfg.title;
        els.metricDetailText.textContent = cfg.getText(metrics);

        const pageId = METRIC_TO_PAGE[key];
        if (pageId) activateWorkspacePage(pageId);

        renderMiniDash(key, metrics, siem.incidents);
      }

      metricCards.forEach(card => {
        card.addEventListener("click", () => {
          const key = card.dataset.key;
          updateMetricDetail(key, siem.metrics);
        });
      });

      wsTabs.forEach(tab => {
        tab.addEventListener("click", () => {
          const pageId = tab.dataset.page;
          activateWorkspacePage(pageId);
        });
      });

      const fleetTableBody = document.querySelector("#fleetTable tbody");
      $("btnAddVessel").addEventListener("click", () => {
        const name = $("fleetName").value.trim();
        const id = $("fleetId").value.trim();
        const role = $("fleetRole").value;
        if (!name || !id) return;

        const tr = document.createElement("tr");
        tr.innerHTML =
          `<td>${name}</td><td>${id}</td><td>${role}</td><td>${fmtTime.format(new Date())}</td>`;
        fleetTableBody.appendChild(tr);

        if (!siem.activeVessel) {
          siem.activeVessel = name;
          if (els.wsSubtitle) {
            els.wsSubtitle.textContent =
              `Execution scope: simulated incidents focused on vessel "${name}".`;
          }
        }

        $("fleetName").value = "";
        $("fleetId").value = "";
      });

      $("btnClearFleet").addEventListener("click", () => {
        fleetTableBody.replaceChildren();
        siem.activeVessel = null;
        if (els.wsSubtitle) {
          els.wsSubtitle.textContent =
            "Select a metric or module to open its execution view for fishing fleets and private commercial tenants.";
        }
      });

      const satLog = $("satLog");
      $("btnSatHealth").addEventListener("click", () => {
        const profile = $("satProfile").value;
        const vessel = $("satVessel").value || siem.activeVessel || "all registered vessels";
        const latency = (400 + Math.random() * 300).toFixed(0);
        const loss = (Math.random() * 1.5).toFixed(2);
        satLog.textContent =
          `[${fmtTime.format(new Date())}] SatCom health check on ${vessel} (${profile}) → latency ${latency} ms, loss ${loss}%.`;
      });
      $("btnSatBaseline").addEventListener("click", () => {
        satLog.textContent =
          `[${fmtTime.format(new Date())}] Updated SatCom baseline for current profile.`;
      });

      const vhfLog = $("vhfLog");
      $("btnApplyVhf").addEventListener("click", () => {
        const chks = Array.from(document.querySelectorAll(".vhf-ch:checked"));
        const list = chks.map(c => c.value).join(", ") || "no guarded channels";
        vhfLog.textContent =
          `[${fmtTime.format(new Date())}] VHF guard policy applied: ${list}.`;
      });

      const aisLog = $("aisLog");
      $("btnAisScan").addEventListener("click", () => {
        const anomalies = Math.floor(Math.random() * 4);
        aisLog.textContent =
          `[${fmtTime.format(new Date())}] AIS integrity scan completed. Anomalies detected: ${anomalies}.`;
      });

      const epLog = $("epLog");
      $("btnEpScan").addEventListener("click", () => {
        const group = $("epGroup").value;
        const depth = $("epDepth").value;
        epLog.textContent =
          `[${fmtTime.format(new Date())}] Endpoint ${depth} scan launched for ${group} group (simulated).`;
      });

      const accLog = $("accLog");
      $("btnApplyAccess").addEventListener("click", () => {
        const policy = $("accPolicy").value;
        const mfa = $("accMfa").value;
        accLog.textContent =
          `[${fmtTime.format(new Date())}] Access policy set to ${policy} with MFA scope: ${mfa}.`;
      });

      const drillLog = $("drillLog");
      $("btnLaunchDrill").addEventListener("click", () => {
        const scen = $("drillScenario").value;
        const vessel = $("drillVessel").value || siem.activeVessel || "fleet‑wide";
        drillLog.textContent =
          `[${fmtTime.format(new Date())}] Drill launched (${scen}) targeting ${vessel} (simulated).`;
      });

      const geoLog = $("geoLog");
      $("btnApplyGeo").addEventListener("click", () => {
        const name = $("geoName").value || "Unnamed fence";
        const radius = $("geoRadius").value || "25";
        geoLog.textContent =
          `[${fmtTime.format(new Date())}] Geo‑fence "${name}" applied with radius ${radius} NM.`;
      });

      const cmpLog = $("cmpLog");
      $("btnSaveCompliance").addEventListener("click", () => {
        const days = $("cmpRetention").value;
        const profile = $("cmpProfile").value;
        cmpLog.textContent =
          `[${fmtTime.format(new Date())}] Compliance profile "${profile}" saved with retention ${days} days.`;
      });

      const foLog = $("foLog");
      $("btnTestFailover").addEventListener("click", () => {
        const primary = $("foPrimary").value;
        const backup = $("foBackup").value;
        const success = Math.random() > 0.1;
        foLog.textContent =
          `[${fmtTime.format(new Date())}] Failover test from ${primary} to ${backup}: ` +
          (success ? "SUCCESS (simulated)." : "ISSUES detected, review configuration.");
      });

      setTimeout(() => {
        updateMetricDetail("risk", siem.metrics);
        activateWorkspacePage("fleet");
      }, 1500);

      window.addEventListener("beforeunload", () => {
        try{ siem.destroy(); } catch(_){}
      }, { capture:true });

      window.goTo = function(page){
        window.location.href = page;
      };
    })();
  </script>
</body>
</html>






